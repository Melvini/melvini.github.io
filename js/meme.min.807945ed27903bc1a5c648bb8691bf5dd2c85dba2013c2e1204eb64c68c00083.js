const throttle=(fn,wait)=>{let inThrottle,lastFn,lastTime;return function(){const context=this,args=arguments;if(!inThrottle){fn.apply(context,args);lastTime=Date.now();inThrottle=true;}else{clearTimeout(lastFn);lastFn=setTimeout(function(){if(Date.now()-lastTime>=wait){fn.apply(context,args);lastTime=Date.now();}},Math.max(wait-(Date.now()-lastTime),0));}};};const delayTime=420;;const backToTop=document.getElementById('back-to-top');if(backToTop!==null){window.addEventListener('scroll',throttle(function(){window.scrollY>100?backToTop.classList.add('show'):backToTop.classList.remove('show');},delayTime));};if(userPrefers==='dark'){changeMode('dark');}else if(userPrefers==='light'){changeMode('light');}else if(darkModeMediaQuery.matches){changeMode('dark');}else if(lightModeMediaQuery.matches){changeMode('light');}
darkModeMediaQuery.addListener((e)=>{const darkModeOn=e.matches;if(darkModeOn){changeModeMeta('dark');changeMode('dark');setMode('dark');}});lightModeMediaQuery.addListener((e)=>{const lightModeOn=e.matches;if(lightModeOn){changeModeMeta('light');changeMode('light');setMode('light');}});const themeSwitcher=document.getElementById('theme-switcher');themeSwitcher.addEventListener('click',function(){const currentMode=document.documentElement.getAttribute('data-theme');if(currentMode==='dark'){changeModeMeta('light');changeMode('light');setMode('light');}else{changeModeMeta('dark');changeMode('dark');setMode('dark');}});window.addEventListener('storage',function(event){if(event.newValue==='dark'){changeModeMeta('dark');changeMode('dark');}else{changeModeMeta('light');changeMode('light');}});function changeMode(theme){var isDark=theme==='dark';document.getElementById('theme-switcher').innerHTML=isDark?'🌙':'☀️';var oldChromaTheme=isDark?'chroma':'chroma-dark';var newChromaTheme=isDark?'chroma-dark':'chroma';[].slice.apply(document.getElementsByClassName(oldChromaTheme)).forEach((e)=>{e.className=newChromaTheme;});}
function setMode(theme){window.localStorage.setItem('theme',theme);};document.querySelectorAll('table').forEach((e)=>{e.outerHTML=`<div class="table-container">${e.outerHTML}</div>`;});;const copyText='复制';const copiedText='已复制';document.querySelectorAll('.post-body > pre').forEach((e)=>{e.outerHTML=`<div style="position: relative">${e.outerHTML}</div>`;});function addCopyButtons(clipboard){const divs=document.querySelectorAll('table.lntable, .highlight > pre, .post-body > div > pre');divs.forEach((containerEl)=>{containerEl.parentNode.style.position='relative';const button=document.createElement('button');button.className='copy-button';button.type='button';button.innerText=copyText;if(containerEl.classList.contains('lntable')){var codeBlock=containerEl.querySelectorAll('.lntd')[1];}else{var codeBlock=containerEl.querySelector('code');}
button.addEventListener('click',()=>{clipboard.writeText(codeBlock.innerText).then(()=>{button.blur();button.innerText=copiedText;setTimeout(()=>{button.innerText=copyText;},1000);}).catch((error)=>{button.innerText='Error';console.error(error);});});containerEl.appendChild(button);containerEl.parentNode.addEventListener('mouseover',()=>{button.style='visibility: visible; opacity: 1';});containerEl.parentNode.addEventListener('mouseout',()=>{button.style='visibility: hidden; opacity: 0';});});}
if(navigator&&navigator.clipboard){addCopyButtons(navigator.clipboard);}else{const script=document.createElement('script');script.src='https://cdn.jsdelivr.net/npm/clipboard-polyfill@2.8.6/dist/clipboard-polyfill.min.js';script.defer=true;script.onload=function(){addCopyButtons(clipboard);};document.body.appendChild(script);};const commentsToggle=document.getElementById('load-comments');if(commentsToggle!==null){commentsToggle.addEventListener('click',function(){loadComments();this.style="display: none";});};